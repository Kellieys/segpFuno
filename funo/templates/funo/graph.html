


{% load static %}


  
    <link rel="stylesheet" type="text/css" href="{% static 'funo/css/loader.css' %}">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js'></script>
    

    <script>
                    $(document).ready(function(){
                        var endpoint = 'model/'
                        var defaultData = [];
                        var labels = [];
                        var data1=[];
                        var data2=[];
                        var i,commodity,current_price,current_date,price_change;
                        var html = "<h4> Recent price </h4><table class ='table table-stripped'><thead><tr><th>Date</th><th>Price (Malaysian Ringgit) </th></tr></thead><tbody>";
                        $.ajax({
                            method: "GET",
                            url: endpoint,
                            success: function(data){
                                labels = data.labels.split(",")
                                defaultData = data.default.split(",")
                                forecast=data.forecast
                                current = data.current
                                title=data.title
                                commodity = data.commodityItem
                                current_date = data.current_date
                                current_price = data.current_price
                                current_price=parseFloat(current_price).toFixed(2);
                                
                               
                                




                                if (forecast==0){
                                    for (i=0;i<labels.length;i++){
                                        data1[i]=parseFloat(defaultData[i]).toFixed(2);
                                        data2[i]=null;
                                   
                                    };
                                    setChart() 

                                } 
                                
                                else{
                                    console.log(data)
                                    for (i=0;i<labels.length-(forecast-1);i++){
                                        data1[i]=parseFloat(defaultData[i]).toFixed(2);
                                        data2[i]=null;

                                    }
                                    price_change = (data1[labels.length-(forecast)]-data1[labels.length-(forecast)-1])/data1[labels.length-(forecast)-1]*100;
                                    price_change =  price_change.toFixed(2);
                                    data2[labels.length-(forecast)]=defaultData[labels.length-(forecast)];
                                    for (i=labels.length-(forecast-1);i<labels.length;i++){
                                        data1[i]=null;
                                        data2[i]=parseFloat(defaultData[i]).toFixed(2);
                                    }
                                    setChart()                                     
                                } 
                                
                                document.getElementById("commodityItem").innerHTML = commodity
                                document.getElementById("current_price").innerHTML = "RM"+current_price.toString();
                                document.getElementById("price_change").innerHTML = price_change + "%"
                                var y = labels.length-forecast+1
                                if (y<25){
                                    for(var i =0;i<labels.length-forecast+1;i++){
                                    html+="<tr>";
                                    html+="<td>"+labels[labels.length-forecast-i]+"</td>";
                                    html+="<td>"+parseFloat(defaultData[defaultData.length-forecast-i]).toFixed(2).toString()+"</td>";
                                    html+="</tr>"
                                }
                                html+="</tr></table>";
                                

                                }
                                else{
                                    for(var i =0;i<10;i++){
                                    html+="<tr>";
                                    html+="<td>"+labels[labels.length-forecast-i]+"</td>";
                                    html+="<td>"+parseFloat(defaultData[defaultData.length-forecast-i]).toFixed(2).toString()+"</td>";
                                    html+="</tr>"
                                }
                                html+="</tr></table>";
                                }
                                document.getElementById('tableItem').innerHTML=html;
                                var x = "";

                                if(commodity=="Chicken") {x="<a href={% static 'funo/rawData/poultry/chicken/chicken.csv'%} download>";}
                                
                                else if (commodity=="Coconut") {x="<a href={% static 'funo/rawData/coconut/coconut.csv'%} download>";}
                                else if (commodity=="Water Spinach (Kang-kong)") {x="<a href={% static 'funo/rawData/vegetables/kangkung/kangkung.csv'%} download>";}
                                else if (commodity=="Choy Sum") {x="<a href={% static 'funo/rawData/vegetables/sawiHijau/sawiHijau.csv'%} download>";}
                                else if (commodity=="Tomato") {x="<a href={% static 'funo/rawData/fruits/tomato/tomato.csv'%} download>";}
                                else if (commodity=="Red Chili") {x="<a href={% static 'funo/rawData/fruits/chilli/chilli.csv'%} download>";}
                                else if (commodity=="Egg (Grade A)"){x="<a href={% static 'funo/rawData/poultry/eggA/eggA.csv'%} download>";}
                                else if (commodity=="Egg (Grade B)") {x="<a href={% static 'funo/rawData/poultry/eggB/eggB.csv'%} download>";}
                                else if (commodity=="Egg (Grade C)") {x="<a href={% static 'funo/rawData/poultry/eggC/eggC.csv'%} download>";}
                                else{x="<a href={% static 'funo/rawData/poultry/chicken/chicken.csv'%} download>";}


                                var r =x+"Download Complete Data</a>";
                                


                                
                                document.getElementById('downloadLink').innerHTML = r;
                            },
                            
                            error: function(error_data){
                                console.log("error")
                                console.log(error_data)
                            },
                            complete: function(){
                                $('#loader').hide();
                            },
                            
                        });

                        function setChart(){ 
                            var ctx = document.getElementById("myChart");
                            var ctx = document.getElementById("myChart");
                            var ctx2 = document.getElementById("myChart2");
                            var myChart = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: labels,
                                datasets: [{
                                    label: 'Price',
                                    fill:'true',
                                    data: data1,
                                    pointRadius:1,
                                    backgroundColor: 'rgb(49, 113, 133,0.1)',
                                    borderColor: 'rgb(49, 113, 133)',
                                    borderWidth: 1,
                                    pointHoverRadius:5
                                },
                                {
                                    label: 'Forecast Price',
                                    fill:true,
                                    data: data2,
                                    pointRadius:1,
                                    backgroundColor: 'rgb(99, 217, 93,0.1)',
                                    borderColor: 'rgb(99, 217, 93)',
                                    borderWidth: 1,
                                    pointHoverRadius:5
                                }]
                            },
                            options: {
                                scales: {
                                    yAxes: [{
                                        ticks: {
                                            beginAtZero:true,
                                            
                                            scaleLabel: {
                                                display: true,
                                                labelString: 'Price (RM)'
                                            }
                                        }
                                    }],
                                    xAxes: [{
                                        ticks: {
                                            autoSkip:true,
                                            maxTicksLimit:20,
                                            scaleLabel: {
                                                display: true,
                                                labelString: 'Date'
                                            }
                                        }
                                    }]
                                },
                               title:{
                                   display:true,
                                   text:title
                               },
                                hover: {
                                    mode: 'index'
                                }

                            }
                        });
                        }
                    });  
                </script>



{% comment %} {%block graph_content%}
<div id='loader'>
    <div class="button">
         <div class="loader"></div>
    </div>
</div>
<canvas id="myChart" style="display:block; height: 266px; width: 532px;" width="500" height="150"></canvas>
                   

<form action="" method="GET">
    <label for="commodity">Comodity</label>
        <select id="commodity" name="commodity">
            <option name="option" value="poultry">Poultry</option>
            <option name="option" value="vegetable">Vegetable</option>
        </select>
    <input type="submit" value="Submit">
</form>

{%end block%} {% endcomment %}